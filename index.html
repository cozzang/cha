<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>chasua</title>
  <style>
    :root { --gap: 12px; }
    html,body { height: 100%; margin: 0; background:#111; color:#eee; }
    header { position: sticky; top: 0; background:#111; padding: 10px var(--gap); display:flex; gap:8px; align-items:center; border-bottom:1px solid #222; z-index: 10; }
    button { padding: 6px 10px; border-radius: 10px; border:1px solid #333; background:#1b1b1b; color:#eee; }
    #viewer { padding: var(--gap); display:grid; gap: var(--gap); }
    .page { background:#fff; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,.3); overflow:hidden; }
    .msg { padding: 10px var(--gap); font-size: 14px; color:#bbb; }
    .sr-only { position:absolute; left:-9999px; }
  </style>
</head>
<body>
  <header>
    <strong>ğŸ“„ chasua.pdf</strong>
    <button onclick="location.href='/chasua.pdf'" aria-label="ë‹¤ìš´ë¡œë“œ">ë‹¤ìš´ë¡œë“œ</button>
  </header>

  <div id="viewer" role="region" aria-label="PDF viewer"></div>
  <div id="status" class="msg">ë¡œë”© ì¤‘â€¦</div>

  <!-- PDF.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script>
    // ì›Œì»¤ ì„¤ì • (í•„ìˆ˜)
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js";

    const PDF_URL = "/chasua.pdf"; // ê°™ì€ ë ˆí¬ ë£¨íŠ¸ì— chasua.pdfê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
    const viewer = document.getElementById("viewer");
    const status = document.getElementById("status");

    // ë””ë°”ì´ìŠ¤ í”½ì…€ë°€ë„ ê³ ë ¤í•´ ì„ ëª…ë„ ìœ ì§€
    const DPR = Math.max(1, window.devicePixelRatio || 1);

    // ê°€ë¡œí­ì— ë§ì¶°ì„œ í˜ì´ì§€ í¬ê¸° ê³„ì‚°
    function computeScale(page, targetCSSWidth) {
      const viewport = page.getViewport({ scale: 1 });
      return targetCSSWidth / viewport.width;
    }

    async function renderPage(pdf, pageNum) {
      const page = await pdf.getPage(pageNum);

      // ëª©í‘œ ë„ˆë¹„: í™”ë©´ ì—¬ë°± ê°ì•ˆ (íŒ¨ë”© 24px)
      const containerWidth = Math.max(320, document.documentElement.clientWidth - 2 * 12);

      const scale = computeScale(page, containerWidth);
      const viewport = page.getViewport({ scale });

      // ìº”ë²„ìŠ¤ ìƒì„±
      const canvas = document.createElement("canvas");
      const wrapper = document.createElement("div");
      wrapper.className = "page";
      wrapper.appendChild(canvas);
      viewer.appendChild(wrapper);

      // DPI ë³´ì •(ê³ í•´ìƒë„ ë Œë”ë§)
      canvas.style.width = viewport.width + "px";
      canvas.style.height = viewport.height + "px";
      canvas.width = Math.floor(viewport.width * DPR);
      canvas.height = Math.floor(viewport.height * DPR);

      const ctx = canvas.getContext("2d");
      const renderContext = {
        canvasContext: ctx,
        transform: [DPR, 0, 0, DPR, 0, 0],
        viewport
      };

      await page.render(renderContext).promise;
    }

    async function main() {
      try {
        // ë¡œë“œ
        const pdf = await pdfjsLib.getDocument(PDF_URL).promise;
        status.textContent = `ì´ ${pdf.numPages}í˜ì´ì§€ ë¡œë”© ì¤‘â€¦`;

        // ìˆœì°¨ ë Œë”ë§(ëª¨ë°”ì¼ ë©”ëª¨ë¦¬ ì•ˆì •ì„±)
        for (let i = 1; i <= pdf.numPages; i++) {
          await renderPage(pdf, i);
        }
        status.textContent = "ì™„ë£Œ";
        setTimeout(() => (status.style.display = "none"), 800);

      } catch (err) {
        console.error(err);
        status.textContent = "PDFë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ ê²½ë¡œë‚˜ ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.";
      }
    }

    // ë·°í¬íŠ¸ ë³€ê²½ ì‹œ ë¦¬ë Œë” (ê°„ë‹¨íˆ ìƒˆë¡œê³ ì¹¨)
    window.addEventListener("orientationchange", () => location.reload());
    window.addEventListener("resize", () => { /* í•„ìš” ì‹œ throttle í›„ ì¬ë Œë” êµ¬í˜„ ê°€ëŠ¥ */ });

    main();
  </script>
</body>
</html>
